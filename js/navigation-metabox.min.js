if("undefined"==typeof bu||void 0===bu.plugins||void 0===bu.plugins.navigation)throw new TypeError("BU Navigation Metabox dependencies have not been met!");var tb_position;!function(l){var u;bu.plugins.navigation.views=bu.plugins.navigation.views||{},bu.plugins.navigation.views.Metabox={el:"#bunavattrsdiv",ui:{treeContainer:"#edit-post-tree",moveBtn:"#move-post-button",breadcrumbs:"#bu-post-breadcrumbs"},inputs:{label:'[name="nav_label"]',visible:'[name="nav_display"]',postID:'[name="post_ID"]',originalStatus:'[name="original_post_status"]',parent:'[name="parent_id"]',order:'[name="menu_order"]',autoDraft:'[name="auto_draft"]'},data:{modalTree:void 0,breadcrumbs:"",label:""},initialize:function(){var t,e,i,n,a;return this.settings=nav_metabox_settings,this.settings.el=this.ui.treeContainer,this.settings.isNewPost=1==l(this.inputs.autoDraft).val(),t=l(this.inputs.originalStatus).val(),e=parseInt(l(this.inputs.parent).val(),10),i=parseInt(l(this.inputs.order).val(),10),n=l(this.inputs.label).val()||"(no title)",a=l(this.inputs.visible).attr("checked")||!1,this.settings.currentPost={ID:parseInt(l(this.inputs.postID).val(),10),post_title:n,post_status:"auto-draft"==t?"new":t,post_parent:e,menu_order:i,post_meta:{excluded:!a},originalParent:e,originalExclude:!a},l(this.ui.treeContainer).addClass("current-post-status-"+t),this.$el=l(this.el),this.loadNavTree(),this.attachHandlers(),this},loadNavTree:function(t){void 0===this.data.modalTree&&(this.data.modalTree=ModalPostTree(this.settings),this.data.modalTree.listenFor("locationUpdated",l.proxy(this.onLocationUpdated,this)))},attachHandlers:function(){this.$el.delegate(this.ui.moveBtn,"click",this.data.modalTree.open),this.$el.delegate(this.inputs.label,"blur",l.proxy(this.onLabelChange,this)),this.$el.delegate(this.inputs.visible,"click",l.proxy(this.onToggleVisibility,this))},onLabelChange:function(t){var e=l(this.inputs.label).attr("value");this.settings.currentPost.post_title=e,u.updatePost(this.settings.currentPost),u.save(),this.updateBreadcrumbs(this.settings.currentPost)},onToggleVisibility:function(t){var e=l(t.target).attr("checked"),i=nav_metabox_settings.topLevelDisabled+"\n\n"+nav_metabox_settings.topLevelNotice;e&&!this.isAllowedInNavigationLists(this.settings.currentPost)?(t.preventDefault(),this.notify(i)):(this.settings.currentPost.post_meta.excluded=!e,u.updatePost(this.settings.currentPost),u.save())},onLocationUpdated:function(t){l(this.inputs.parent).val(t.post_parent),l(this.inputs.order).val(t.menu_order),this.updateBreadcrumbs(t),this.settings.currentPost=t},updateBreadcrumbs:function(t){var i,n,a=u.getAncestors(t.ID);!1!==a&&(i=l(this.ui.breadcrumbs).clone().empty(),l.each(a,function(t,e){n=l("<li></li>").html(e),t<a.length-1?n.append("<ul></ul>"):n.addClass("current"),0===t?i.append(n):i.find("ul").last().append(n)}),1<i.find("li").length?l(this.ui.breadcrumbs).replaceWith(i):l(this.ui.breadcrumbs).html('<li class="current">'+nav_metabox_settings.topLevelLabel+"</li>"))},isAllowedInNavigationLists:function(t){return!1===t.originalExclude&&0===t.originalParent||0!==t.post_parent||this.settings.allowTop},notify:function(t){alert(t)}},ModalPostTree=bu.plugins.navigation.views.ModalPostTree=function(t){var e,r={},a=r.conf={treeContainer:"#edit-post-tree",toolbarContainer:".post-placement-toolbar",navSaveBtn:"#bu-post-placement-save",navCancelBtn:"#bu-post-placement-cancel",treeDragContainer:"#TB_ajaxContent"},a=l.extend(a,t);bu.signals.register(r);return r.open=function(t){var e=l(window).width(),i=l(window).height(),n=720<e?720:e,a=t.target.title||t.target.name||null,s=t.target.href||t.target.alt,o=t.target.rel||!1;return s=(s=(s=s.replace(/&width=[0-9]+/g,"")).replace(/&height=[0-9]+/g,""))+"&width="+(n-80)+"&height="+(i-85),tb_show(a,s,o),r.scrollToSelection(),l("#TB_window").on("unload tb_unload",function(t){r.saving?r.saving=!1:u.restore()}),!1},r.scrollToSelection=function(){var t,e,i,n=l(a.treeContainer).jstree("get_selected");n.length&&(e=(t=l(a.treeDragContainer)).innerHeight(),0<(i=n.position().top+n.height()/2-e/2)&&t.scrollTop(i))},r.onUpdateLocation=function(t){t.preventDefault(),r.broadcast("locationUpdated",[u.getCurrentPost()]),u.save(),r.saving=!0,tb_remove()},r.onCancelMove=function(t){t.preventDefault(),tb_remove()},u=r.tree=bu.plugins.navigation.tree("edit_post",a),(e=l(a.toolbarContainer)).on("click",a.navSaveBtn,r.onUpdateLocation),e.on("click",a.navCancelBtn,r.onCancelMove),a.lazyLoad?u.listenFor("lazyLoadComplete",u.save):u.listenFor("postsSelected",u.save),r}}(jQuery),function(s){tb_position=function(){var t=s("#TB_window"),e=s(window).width(),i=s(window).height(),n=720<e?720:e,a=0;return s("body.admin-bar").length&&(a=28),t.size()&&(t.width(n-50).height(i-45-a),s("#TB_iframeContent").width(n-50).height(i-75-a),s("#TB_ajaxContent").width(n-80).height(i-92-a),t.css({"margin-left":"-"+parseInt((n-50)/2,10)+"px"}),void 0!==document.body.style.maxWidth&&t.css({top:20+a+"px","margin-top":"0"})),s("a.thickbox").each(function(){var t=s(this).attr("href");t&&(t=(t=t.replace(/&width=[0-9]+/g,"")).replace(/&height=[0-9]+/g,""),s(this).attr("href",t+"&width="+(n-80)+"&height="+(i-85-a)))})},s(window).on("resize",function(){tb_position()})}(jQuery),jQuery(document).ready(function(){bu.plugins.navigation.metabox=bu.plugins.navigation.views.Metabox.initialize()});