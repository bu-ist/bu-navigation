if("undefined"==typeof bu||void 0===bu.plugins||void 0===bu.plugins.navigation)throw new TypeError("BU Navigation Metabox dependencies have not been met!");var tb_position;!function(t){var e;bu.plugins.navigation.views=bu.plugins.navigation.views||{},bu.plugins.navigation.views.Metabox={el:"#bunavattrsdiv",ui:{treeContainer:"#edit-post-tree",moveBtn:"#move-post-button",breadcrumbs:"#bu-post-breadcrumbs"},inputs:{label:'[name="nav_label"]',visible:'[name="nav_display"]',postID:'[name="post_ID"]',originalStatus:'[name="original_post_status"]',parent:'[name="parent_id"]',order:'[name="menu_order"]',autoDraft:'[name="auto_draft"]'},data:{modalTree:void 0,breadcrumbs:"",label:""},initialize:function(){var e,i,n,a,s;return this.settings=nav_metabox_settings,this.settings.el=this.ui.treeContainer,this.settings.isNewPost=1==t(this.inputs.autoDraft).val(),e=t(this.inputs.originalStatus).val(),i=parseInt(t(this.inputs.parent).val(),10),n=parseInt(t(this.inputs.order).val(),10),a=t(this.inputs.label).val()||"(no title)",s=t(this.inputs.visible).prop("checked")||!1,this.settings.currentPost={ID:parseInt(t(this.inputs.postID).val(),10),post_title:a,post_status:"auto-draft"==e?"new":e,post_parent:i,menu_order:n,post_meta:{excluded:!s},originalParent:i,originalExclude:!s},t(this.ui.treeContainer).addClass("current-post-status-"+e),this.$el=t(this.el),this.loadNavTree(),this.attachHandlers(),this},loadNavTree:function(e){void 0===this.data.modalTree&&(this.data.modalTree=ModalPostTree(this.settings),this.data.modalTree.listenFor("locationUpdated",t.proxy(this.onLocationUpdated,this)))},attachHandlers:function(){this.$el.on("click",this.ui.moveBtn,this.data.modalTree.open),this.$el.on("blur",this.inputs.label,t.proxy(this.onLabelChange,this)),this.$el.on("click",this.inputs.visible,t.proxy(this.onToggleVisibility,this))},onLabelChange:function(i){var n=t(this.inputs.label).attr("value");this.settings.currentPost.post_title=n,e.updatePost(this.settings.currentPost),e.save(),this.updateBreadcrumbs(this.settings.currentPost)},onToggleVisibility:function(i){var n=t(i.target).prop("checked"),a=nav_metabox_settings.topLevelDisabled+"\n\n"+nav_metabox_settings.topLevelNotice;n&&!this.isAllowedInNavigationLists(this.settings.currentPost)?(i.preventDefault(),this.notify(a)):(this.settings.currentPost.post_meta.excluded=!n,e.updatePost(this.settings.currentPost),e.save())},onLocationUpdated:function(e){t(this.inputs.parent).val(e.post_parent),t(this.inputs.order).val(e.menu_order),this.updateBreadcrumbs(e),this.settings.currentPost=e},updateBreadcrumbs:function(i){var n,a,s;!1!==(n=e.getAncestors(i.ID))&&(a=t(this.ui.breadcrumbs).clone().empty(),t.each(n,(function(e,i){s=t("<li></li>").html(i),e<n.length-1?s.append("<ul></ul>"):s.addClass("current"),0===e?a.append(s):a.find("ul").last().append(s)})),a.find("li").length>1?t(this.ui.breadcrumbs).replaceWith(a):t(this.ui.breadcrumbs).html('<li class="current">'+nav_metabox_settings.topLevelLabel+"</li>"))},isAllowedInNavigationLists:function(t){return!((!1!==t.originalExclude||0!==t.originalParent)&&0===t.post_parent)||this.settings.allowTop},notify:function(t){alert(t)}},ModalPostTree=bu.plugins.navigation.views.ModalPostTree=function(i){var n,a={},s=a.conf={treeContainer:"#edit-post-tree",toolbarContainer:".post-placement-toolbar",navSaveBtn:"#bu-post-placement-save",navCancelBtn:"#bu-post-placement-cancel",treeDragContainer:"#TB_ajaxContent"};s=t.extend(s,i),bu.signals.register(a);return a.open=function(i){var n=t(window).width(),s=t(window).height(),o=720<n?720:n,r=i.target.title||i.target.name||null,l=i.target.href||i.target.alt,u=i.target.rel||!1;return l=(l=(l=l.replace(/&width=[0-9]+/g,"")).replace(/&height=[0-9]+/g,""))+"&width="+(o-80)+"&height="+(s-85),tb_show(r,l,u),a.scrollToSelection(),t("#TB_window").on("unload tb_unload",(function(t){a.saving?a.saving=!1:e.restore()})),!1},a.scrollToSelection=function(){var e,i,n,a;(e=t(s.treeContainer).jstree("get_selected")).length&&(n=(i=t(s.treeDragContainer)).innerHeight(),(a=e.position().top+e.height()/2-n/2)>0&&i.scrollTop(a))},a.onUpdateLocation=function(t){t.preventDefault(),a.broadcast("locationUpdated",[e.getCurrentPost()]),e.save(),a.saving=!0,tb_remove()},a.onCancelMove=function(t){t.preventDefault(),tb_remove()},e=a.tree=bu.plugins.navigation.tree("edit_post",s),(n=t(s.toolbarContainer)).on("click",s.navSaveBtn,a.onUpdateLocation),n.on("click",s.navCancelBtn,a.onCancelMove),s.lazyLoad?e.listenFor("lazyLoadComplete",e.save):e.listenFor("postsSelected",e.save),a}}(jQuery),function(t){tb_position=function(){var e=t("#TB_window"),i=t(window).width(),n=t(window).height(),a=720<i?720:i,s=0;return t("body.admin-bar").length&&(s=28),e.size()&&(e.width(a-50).height(n-45-s),t("#TB_iframeContent").width(a-50).height(n-75-s),t("#TB_ajaxContent").width(a-80).height(n-92-s),e.css({"margin-left":"-"+parseInt((a-50)/2,10)+"px"}),void 0!==document.body.style.maxWidth&&e.css({top:20+s+"px","margin-top":"0"})),t("a.thickbox").each((function(){var e=t(this).attr("href");e&&(e=(e=e.replace(/&width=[0-9]+/g,"")).replace(/&height=[0-9]+/g,""),t(this).attr("href",e+"&width="+(a-80)+"&height="+(n-85-s)))}))},t(window).on("resize",(function(){tb_position()}))}(jQuery),jQuery(document).ready((function(){bu.plugins.navigation.metabox=bu.plugins.navigation.views.Metabox.initialize()}));